<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Listing | ServeKerala Admin</title>
  <meta name="robots" content="noindex,nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>

<header class="site-header">
  <div class="container header-inner">
    <div class="logo"><a href="/admin-dashboard/">ServeKerala Admin</a></div>
  </div>
</header>

<section class="section">
  <div class="container" style="max-width:600px;">
    <h2 class="section-title">Edit Business Listing</h2>

    <form id="editForm">
      <input type="text" id="businessName" placeholder="Business Name" required>
      <input type="text" id="category" placeholder="Category" required>
      <input type="tel" id="phone" placeholder="Phone" required>
      <input type="text" id="district" placeholder="District" required>
      <input type="text" id="city" placeholder="City" required>
      <input type="text" id="area" placeholder="Area" required>

      <textarea id="services" rows="3" placeholder="Services"></textarea>

      <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
  </div>
</section>

<script type="module">
  import { db } from "/assets/js/firebase-config.js";
  import {
    doc,
    getDoc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const ref = doc(db, "listings_requests", id);
  const snap = await getDoc(ref);
  const d = snap.data();

  // Populate form
  businessName.value = d.businessName;
  category.value = d.category;
  phone.value = d.phone;
  district.value = d.district;
  city.value = d.city;
  area.value = d.area;
  services.value = d.services || "";

  // Save changes
  editForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    await updateDoc(ref, {
      businessName: businessName.value,
      category: category.value,
      phone: phone.value,
      district: district.value,
      city: city.value,
      area: area.value,
      services: services.value
    });

    alert("Changes saved");
    window.location.href = "/admin-dashboard/listings/";
  });
</script>

</body>
</html>
